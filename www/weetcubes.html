<!DOCTYPE html>
<html>
<head>
<title>Weetcubes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>

.parsegraph_Surface {
    width: 100%;
    height: 100%;
}

body {
    font-family: sans-serif;
    margin: 0;
    padding: 0;
    background: #111;
    color: #eee;
}

body > div {
    text-align: center;
    position: absolute;
}

.Successful {
    color: green;
}

.Crashed {
    color: maroon;
}

.Failed {
    color: red;
}

@media only screen and (max-width: 980px) {

body > div {
    width: 100%;
}

body > div input {
    clear: left;
}

}
</style>
<script src="parsegraph-1.0.js"></script>
<script src="parsegraph-examples-1.0.js"></script>
<script>

function alpha_WeetCubeWidget()
{
    var surface;
    if(arguments.length === 0) {
        surface = new parsegraph_Surface();
    }
    else {
        surface = arguments[0];
    }
    this.surface = surface;

    this.camera = new alpha_Camera(surface);
    this.camera.SetFovX(60);
    this.camera.SetFarDistance(1000);
    this.camera.SetNearDistance(.1);
    this.camera.SetPosition(-1, -1, -550);

    this.input = new alpha_Input(surface, this.camera);
    this.input.SetMouseSensitivity(.4);

    this.surface.addPainter(this.paint, this);
    this.surface.addRenderer(this.render, this);

    this.cubePainter = null;
    this.rotq = 0;
}

alpha_WeetCubeWidget.prototype.paint = function(elapsed, frozen)
{
    if(elapsed === undefined || Number.isNaN(elapsed)) {
        throw new Error("elapsed must be provided.");
    }

    this.input.Update(elapsed);

    if(frozen) {
        elapsed = 0;
    }

    if(!this.cubePainter) {
        this.cubePainter = new alpha_WeetPainter(this.surface.gl());
    }
    else {
        this.cubePainter.Clear();
    }

    var rotq = this.rotq;
    var max = 25;

    for(var i = 0; i < max; ++i) {
        for(var j = 0; j < max; ++j) {
            for(var k = 0; k < max; ++k) {
                if(k % 2 != 0 || j % 2 != 0 || i % 2 != 0) {
                    continue;
                }

                var c = new alpha_Physical(this.camera);
                c.Rotate(rotq*k/10, 0, 1, 1);
                c.Rotate(rotq*i/15, 1, 0, 0);
                c.Rotate(rotq*j/10, 1, 0, 1);
                c.SetPosition(i, j, k);
                c.SetScale(1, 1, 1);
                c.modelMode = alpha_PHYSICAL_ROTATE_TRANSLATE_SCALE;
                this.cubePainter.Cube(c.GetModelMatrix());
            }
        }

        // Not really necessary, but just constraining the value of this so it
        // doesn't get massive when running in the background.
        if(rotq >= 360) {
            rotq = 0;
        }
        rotq = rotq + 0.01 * elapsed;
    }

    this.rotq = rotq;
};

alpha_WeetCubeWidget.prototype.render = function()
{
    var projection = this.camera.UpdateProjection();
    var viewMatrix = this.camera.GetViewMatrix().Multiplied(projection);
    this.cubePainter.Draw(viewMatrix);
};

document.addEventListener("DOMContentLoaded", function(event) {

parsegraph_initialize();

var surface = new parsegraph_Surface();
document.body.appendChild(surface.container());

surface.addRenderer(function() {
    var gl = surface.gl();
    gl.enable(gl.DEPTH_TEST);
    gl.enable(gl.CULL_FACE);
});

var widget = new alpha_WeetCubeWidget(surface);
WIDGET = widget;

surface.addRenderer(function() {
    var gl = surface.gl();
    gl.clear(gl.DEPTH_BUFFER_BIT);
});

// This flag is used to squelch rendering if that function
// threw an exception and failed to complete.
var speed=.6;
//surface.camera.setCameraPosition(0, 0, 550);
var start = alpha_GetTime();
var frozen = false;
var tick = function(t) {
    // Set the render flag.
    var t = alpha_GetTime();
    surface.paint(t - start, frozen);
    start = t;
    surface.render();

    // Reschedule.
    tickIntervalId = requestAnimationFrame(tick)
};
tickIntervalId = requestAnimationFrame(tick);

parsegraph_addEventListener(document, "keydown", function(event) {
    if(event.key === "Escape") {
        frozen = !frozen;
    }
});

}); // DOMContentLoaded
</script>
</head>
<body>
