<!DOCTYPE html>
<html>
<head>
<title>Parsegraph Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    font-family: sans-serif;
    margin: 0;
    padding: 0;
}

.parsegraph_Surface {
    width: 100%;
    height: 100vh;
    margin: 0;
}

div {
    width: 100%;
    margin: 1em 0;
    text-align: center;
    position: absolute;
}

@media only screen and (max-width: 980px) {

.controls {
    display: none;
}

body > div {
    width: 100%;
}

body > div input {
    clear: left;
}

}
</style>
<script src="parsegraph-1.0.js"></script>
<script src="parsegraph-examples-1.0.js"></script>
<script>

function init()
{
    parsegraph_initialize();

    var server = new parsegraph_CommandClient("./server.fcgi");
    parsegraph_addUserCommands(server);

    var main = document.body;

    var surface = new parsegraph_Surface();
    var graph = new parsegraph_Graph(surface);
    GRAPH = graph;

    var COUNT = 25
    //graph.plot(showCorporateStructure(graph));
    //graph.plot(buildPrimesDemo(graph, COUNT));
    //graph.plot(buildTextDemo(graph, COUNT, "ÁπÅ"));
    //graph.plot(showMemoryBlocks(graph, COUNT));
    //graph.plot(showSpiral(graph));
    //graph.plot(showFunction(graph));
    //graph.plot(showCalendar(graph));
    //graph.plot(showUlam(graph, COUNT));
    //graph.plot(createSliderDemo(graph));

    // Look at alignment here first.
    //graph.plot(showHardTest(graph, server));
    //graph.plot(showStatements(graph));

    // Then correct alignment here.
    graph.plot(showProportionTest(graph, COUNT));

    //graph.plot(showIPAddresses(graph));

    main.appendChild(graph.container());

    if(localStorage.getItem("cameraX") != null) {
        graph.camera().setOrigin(
            Number(localStorage.getItem("cameraX")),
            Number(localStorage.getItem("cameraY"))
        );
        graph.camera().setScale(Number(localStorage.getItem("scale")));
    }

    var cameraInfo = document.createElement("p");

    graph.afterRender = function() {
        localStorage.setItem("cameraX", graph.camera().x());
        localStorage.setItem("cameraY", graph.camera().y());
        localStorage.setItem("scale", graph.camera().scale());

        cameraInfo.innerHTML = "Camera (" + graph.camera().x() + ", " + graph.camera().y() + "), scale=" + graph.camera().scale();

        if(graph._nodePainter._spotlightPainter.hasSpotlights()) {
            graph.surface().scheduleRender();
        }
    };

    var controls = document.createElement("div");
    controls.className = "controls";
    main.appendChild(controls);
    controls.style.bottom = "0";

    var form = parsegraph_createForm();
    form.button("resetOrigin", "Reset Camera");
    form.checkbox("RenderBlocks", graph._nodePainter.isBlockRenderingEnabled());
    form.label("RenderBlocks", "Render blocks");
    form.checkbox("RenderExtents", graph._nodePainter.isExtentRenderingEnabled());
    form.label("RenderExtents", "Render extents");
    form.checkbox("RenderOrigin", graph._nodePainter.isOriginRenderingEnabled());
    form.label("RenderOrigin", "Render origin");
    form.checkbox("RenderSpotlight", graph._nodePainter.isSpotlightRenderingEnabled());
    form.label("RenderSpotlight", "Render spotlights");
    form.checkbox("RenderText", graph._nodePainter.isTextRenderingEnabled());
    form.label("RenderText", "Render text");
    form.button("showGlyphAtlas", "Show glyph atlas");

    var glyphAltasContainer;

    form.addListener(function(sourceName, value) {
        if(sourceName == "resetOrigin") {
            graph.camera().setOrigin(
                graph._gl.drawingBufferWidth / 2,
                graph._gl.drawingBufferHeight / 2
            );
            graph.camera().setScale(1);
        }
        else if(sourceName == "RenderBlocks") {
            if(value) {
                graph._nodePainter.enableBlockRendering();
            }
            else {
                graph._nodePainter.disableBlockRendering();
            }
        }
        else if(sourceName == "RenderLines") {
            if(value) {
                graph._nodePainter.enableLineRendering();
            }
            else {
                graph._nodePainter.disableLineRendering();
            }
        }
        else if(sourceName == "RenderExtents") {
            if(value) {
                graph._nodePainter.enableExtentRendering();
            }
            else {
                graph._nodePainter.disableExtentRendering();
            }
        }
        else if(sourceName == "RenderSpotlight") {
            if(value) {
                graph._nodePainter.enableSpotlightRendering();
            }
            else {
                graph._nodePainter.disableSpotlightRendering();
            }
        }
        else if(sourceName == "RenderOrigin") {
            if(value) {
                graph._nodePainter.enableOriginRendering();
            }
            else {
                graph._nodePainter.disableOriginRendering();
            }
        }
        else if(sourceName == "RenderText") {
            if(value) {
                graph._nodePainter.enableTextRendering();
            }
            else {
                graph._nodePainter.disableTextRendering();
            }
        }
        else if(sourceName == "showGlyphAtlas") {
            graph._nodePainter._textPainter._glyphAtlas.canvas().style.display = "";
        }
        else {
            return;
        }

        graph.surface().scheduleRender();
    });

    controls.appendChild(form.asDOM());
    controls.appendChild(cameraInfo);
    main.appendChild(document.createElement("div"));
    main.lastChild.appendChild(graph._nodePainter._textPainter._glyphAtlas.canvas());
    main.lastChild.lastChild.style.display = "none";
    parsegraph_addButtonListener(main.lastChild, function() {
        main.lastChild.lastChild.style.display = "none";
    });
    var glyphAltasContainer = main.lastChild;
}

document.addEventListener("DOMContentLoaded", function(event) {
    init();
});
</script>
</head>
<body>
</body>
</html>
